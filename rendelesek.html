<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="css/rendelesek.css">
    <title>DemonCars</title>
    <link rel="icon" type="image/x-icon" href="/img/favicon.png">
</head>
<body>
<header>
    <p class="sz">DEM <img src="/img/demoncarslogo.png" alt="Logo" class="logo">NCARS</p>
    <div class="user-icon-container">
        <img src="https://cdn-icons-png.flaticon.com/512/149/149071.png" alt="Felhasználó" title="Bejelentkezés/Kijelentkezés" id="user-icon">
      </div>
</header>

<div id="orders-container"></div>

<script>
document.addEventListener("DOMContentLoaded", function () {
    fetchOrders();
});

function fetchOrders() {
    fetch("orders.php")
        .then(response => response.json())
        .then(orders => {
            let container = document.getElementById("orders-container");
            container.innerHTML = "";

            orders.forEach(order => {
                let orderDiv = document.createElement("div");
                orderDiv.classList.add("order");

                let createdDate = new Date(order.created_at);
                let deliveryDate = new Date(createdDate);
                deliveryDate.setDate(createdDate.getDate() + 3);
                
                orderDiv.innerHTML = `
                    <p><strong>Rendelés ID:</strong> ${order.id}</p>
                    <p><strong>Név:</strong> ${order.name}</p>
                    <p><strong>Email:</strong> ${order.email}</p>
                    <p><strong>Összeg:</strong> ${order.total_price} Ft</p>
                    <p><strong>Fizetési mód:</strong> ${order.payment_method}</p>
                    <p><strong>Létrehozás dátuma:</strong> ${order.created_at}</p>
                    <p><strong>Várható szállítás:</strong> ${deliveryDate.toISOString().split('T')[0]}</p>
                    <button onclick="processOrder(${order.id}, 'accept')">Elfogadás</button>
                    <button onclick="processOrder(${order.id}, 'delete')">Törlés</button>
                    <hr>
                `;

                container.appendChild(orderDiv);
            });
        });
}

function processOrder(orderId, action) {
    let formData = new FormData();
    formData.append("order_id", orderId);
    formData.append("action", action);

    fetch("process_order.php", {
        method: "POST",
        body: formData
    })
    .then(response => response.text())
    .then(message => {
        alert(message);
        fetchOrders();
    });
}
</script>

</body>
</html>

